# wg-manager

## Описание

`wg-manager` позволяет полностью автоматизировать конфигурирование `Wireguard`.

## Конфигурация сервера

При первом запуске программа сама создаёт все необходимые файлы в папке, в которой находится, а именно:

  - `clients.json` - содержит информацию о клиентах
  - `servers.json` - содержит информацию о серверах

Все файлы в формате JSON, все параметры - строки.

Однако перед тем, как программа полноценно заработает нужно отредактировать файл `servers.json`, задав обязательные параметры.

### Обязательные параметры конфигурации

  - `InterfaceName` - имя создаваемого интерфейса `Wireguard`
  - `IP` - IP-адрес, который будет назначен туннельному интерфейсу данного сервера
  - `Domain` - доменное, который будет добавлен к имени всех клиентов данного сервера и самого сервера

>Должны быть заданы, для работы программы

### Параметры, устанавливаемые по умолчанию

  - `InterfaceDescription` - комментарий к туннельному интерфейсу данного сервера (По умолчанию - имя хоста + `Domain`)
  - `Port` - номер порта данного сервера (По умаолчанию - генерируется случайный порт)
  - `PrivateKey` - Приватный ключ данного сервера (По умолчанию - генерируется случайная пара приватного и публичного ключей)
  - `PublicKey` - Публичный ключ данного сервера (По умолчанию - генерируется случайная пара приватного и публичного ключей)

>Если не заданы, то будет установлено значение по умолчанию

### Необязательные параметры

  - `Keepalive` - интервал обмена пакетами keepalive, для преодоления NAT
  - `FirewallMark` - значение, которым помечаются пакеты идущие через туннельный интерфейс (либо десятичная, либо, с приставкой `0x` шестнадцатеричная цифра)
  - `RouteTable` - номер таблицы маршрутизации, который будут использовать пакеты проходящие через данный интерфейс
  - `RouteMetric` - метрика создаваемых маршрутов

>Если не заданы, то будут отсутствовать в конфигурации, генерируемой программой

## Использование

`wg-manager ключи через пробел`

### Ключи

#### Основные

  - `--newclient` - добавить нового клиента
  - `--delclient` - удалить нового клиента
  - `--genclientconfig` - сгенерировать конфигурацию клиента
  - `--genserverconfig` - сгенерировать конфигурации сервера
  
#### Дополнительные

  - `--name имя` - задаёт имя клиента, над которым проводится операция

## TODO

  - [x] Реализовать базовый объект и функционал клиента
  - [x] Реализовать базовый объект и функционал сервера
  - [x] Реализовать отображение списка клиентов
  - [x] Реализовать чтение и запись клиентов и серверов в файл
  - [x] Реализовать функционал удаления и добавления клиентов
  - [x] Реализовать генерацию конфигурационных файлов в формате `SystemD`
  - [ ] Реализовать поддержку нескольких серверов и привязку к ним клиентов
    - [ ] Доработать в связи с этим отображение списка клиентов
    - [ ] Реализовать функционал удаления и добавления серверов
  - [ ] Реализовать генерацию конфигурационных файлов для в формате `Wireguard`
  - [ ] Реализовать отображение QR-кодов
  - [ ] Добавить режим работы в качестве HTTP API-сервера
  - [ ] Реализовать отдачу конфигурации в заданном формате при помощи динамически генерируемого одноразового токена
  - [ ] Реализовать динамическое добавление и удаление серверов/клиентов без перезапуска интерфейсов
  - [ ] Реализовать возможность взаимодействия с `Bind` для динамического добавления DNS-записей
  - [ ] Сверстать и стилизовать страницы HTTP API-сервера с помощью HTML+CSS
  - [ ] Повысить читаемость кода
    - [ ] Грамотно разбить код на файлы/директории/подмодули
    - [ ] Проверить код и весь повторно используемый вынести в функции
    - [ ] Перевести все ошибки на русский
    - [ ] Добавить комментарии ко всем функция/типам и т.д.
  - [ ] Сделать нормальную систему логов с уровнями
    - [ ] Определить систему уровней логгирования
    - [ ] Глобально определить логгеры для всех используемы уровней
    - [ ] Заменить везде обычный `fmt.Printf` на `log`